# 401 Unauthorized in local dev — Telegram DevMode disabled by default

**Date:** 2026-02-28 09:40
**Files:** backend/src/StuffTracker.Api/appsettings.Development.json
**Severity:** medium

## Problem

`GET http://localhost:4200/api/locations` returns 401 (Unauthorized) when opening
the frontend in a local browser. The backend rejects all API requests because
no `X-Telegram-Init-Data` header is present.

## Root Cause

The Telegram auth middleware requires `X-Telegram-Init-Data` header on every request.
In DevMode, it bypasses validation and uses a fake user. However, `appsettings.Development.json`
shipped with `"DevMode": false` — so even in Development environment, the backend rejected
requests without the Telegram header.

The frontend correctly returns `null` from `TelegramService.getInitData()` when not inside
Telegram, and the interceptor passes requests through without the header. This is correct
behavior — the problem was purely backend configuration.

## Solution

Changed `"DevMode": false` to `"DevMode": true` in `appsettings.Development.json`.

The backend already has a double guard in `Program.cs`:
`isDevModeEnabled = telegramSettings.DevMode && builder.Environment.IsDevelopment()`
— so DevMode only activates when ASPNETCORE_ENVIRONMENT=Development. Safe to default to true
in the Development config file.

## Prevention

- When adding auth middleware with a dev bypass, enable the bypass by default in Development config
- Document the DevMode setting in getting-started docs (already done in docs/configuration.md)
- The double guard pattern (feature flag + environment check) is correct and should be used for all dev-only bypasses

## Tags

`#auth` `#devmode` `#configuration` `#401` `#telegram`
